import{_ as w,p as m,o as A,c as n,a as s,t as i,F as f,r as g,q as y,s as h,h as k,i as v,d as o,z as C,e as E}from"./index-D9BKMBNa.js";import{P as B}from"./ProductRow-Bq9a4zkS.js";import"./image-CPrgbr6F.js";const F={class:"admin-container"},z={class:"admin-header glass-card"},N={class:"header-main"},S={class:"header-btns"},U={class:"stats-bar"},x={class:"stat-item"},M={class:"stat-value"},T={class:"stat-item"},V={class:"stat-value processing"},$={class:"stat-item"},L={class:"stat-value shipped"},P={class:"stat-item"},R={class:"stat-value completed"},D={class:"stat-item"},G={class:"stat-value cancelled"},j={class:"filter-bar"},H=["onClick"],J={key:0,class:"loading-state"},K={key:1,class:"order-list"},Q={class:"group-header"},W={class:"order-no"},X={class:"user-name"},Y={class:"items-list"},Z={class:"group-footer"},ss={class:"status-selector"},es={key:0,class:"updating-status"},ts=["value","onChange"],as={__name:"AdminOrderView",setup(ls){const d=v([]),_=v(!0),c=v(null),p=v("å…¨éƒ¨"),b=["å…¨éƒ¨","è™•ç†ä¸­","å·²ç™¼è²¨","å·²å®Œæˆ","å·²å–æ¶ˆ"];m.getUser()?.userId;const I=async()=>{_.value=!0;const a=m.getUser();try{const e=await y.adminGetAllOrders(a.userId);d.value=e.data.data}catch(e){console.error("Fetch admin orders error:",e),h("ç„¡æ³•å–å¾—è¨‚å–®åˆ—è¡¨","error")}finally{_.value=!1}},O=k(()=>{const a={};return!d.value||!Array.isArray(d.value)||(p.value==="å…¨éƒ¨"?d.value:d.value.filter(t=>t.status===p.value)).forEach(t=>{a[t.orderId]||(a[t.orderId]=[]),a[t.orderId].push(t)}),a}),u=k(()=>{const a={total:0,processing:0,shipped:0,completed:0,cancelled:0},e=new Map;return d.value.forEach(t=>{e.has(t.orderId)||e.set(t.orderId,t.status)}),a.total=e.size,e.forEach(t=>{t==="è™•ç†ä¸­"?a.processing++:t==="å·²ç™¼è²¨"?a.shipped++:t==="å·²å®Œæˆ"?a.completed++:t==="å·²å–æ¶ˆ"&&a.cancelled++}),a}),q=async(a,e)=>{if(c.value)return;c.value=a;const t=m.getUser();try{await y.adminUpdateOrder(t.userId,a,e),d.value.forEach(r=>{r.orderId===a&&(r.status=e)}),h("ç‹€æ…‹å·²æ›´æ–°","success")}catch{h("æ›´æ–°å¤±æ•—","error")}finally{c.value=null}};return A(I),(a,e)=>(o(),n("div",F,[s("header",z,[s("div",N,[e[1]||(e[1]=s("div",{class:"header-info"},[s("h1",null,"è¨‚å–®ç¸½è¦½ä¸­å¿ƒ"),s("p",{class:"admin-subtitle"},"è™•ç†å®¢æˆ¶è¨‚å–®èˆ‡ç‰©æµç‹€æ…‹")],-1)),s("div",S,[s("button",{onClick:e[0]||(e[0]=t=>a.$router.push("/admin/products")),class:"sub-nav-btn"}," â† å•†å“ç®¡ç†ä¸­å¿ƒ ")])]),s("div",U,[s("div",x,[e[2]||(e[2]=s("span",{class:"stat-label"},"ç¸½è¨‚å–®æ•¸",-1)),s("span",M,i(u.value.total),1)]),e[7]||(e[7]=s("div",{class:"stat-divider"},null,-1)),s("div",T,[e[3]||(e[3]=s("span",{class:"stat-label"},"è™•ç†ä¸­",-1)),s("span",V,i(u.value.processing),1)]),e[8]||(e[8]=s("div",{class:"stat-divider"},null,-1)),s("div",$,[e[4]||(e[4]=s("span",{class:"stat-label"},"å·²ç™¼è²¨",-1)),s("span",L,i(u.value.shipped),1)]),e[9]||(e[9]=s("div",{class:"stat-divider"},null,-1)),s("div",P,[e[5]||(e[5]=s("span",{class:"stat-label"},"å·²å®Œæˆ",-1)),s("span",R,i(u.value.completed),1)]),e[10]||(e[10]=s("div",{class:"stat-divider"},null,-1)),s("div",D,[e[6]||(e[6]=s("span",{class:"stat-label"},"å·²å–æ¶ˆ",-1)),s("span",G,i(u.value.cancelled),1)])])]),s("div",j,[(o(),n(f,null,g(b,t=>s("button",{key:t,class:C(["filter-tab",{active:p.value===t}]),onClick:r=>p.value=t},i(t),11,H)),64))]),_.value?(o(),n("div",J,[...e[11]||(e[11]=[s("div",{class:"spinner"},null,-1),s("p",null,"è¼‰å…¥ä¸­...",-1)])])):(o(),n("div",K,[(o(!0),n(f,null,g(O.value,(t,r)=>(o(),n("div",{key:r,class:"order-group glass-card"},[s("div",Q,[s("span",W,"# "+i(r),1),s("span",X,"ğŸ‘¤ "+i(t[0].userName),1)]),s("div",Y,[(o(!0),n(f,null,g(t,l=>(o(),E(B,{key:l.pid+l.spec,image:l.image_url||"https://via.placeholder.com/200?text=No+Image",title:l.productName,spec:l.spec,price:Math.round(l.total/l.qty),qty:l.qty,"image-size":150},null,8,["image","title","spec","price","qty"]))),128))]),s("div",Z,[s("div",ss,[c.value===r?(o(),n("div",es,[...e[12]||(e[12]=[s("div",{class:"mini-spinner"},null,-1),s("span",null,"æ›´æ–°ä¸­...",-1)])])):(o(),n("select",{key:1,value:t[0].status,onChange:l=>q(r,l.target.value),class:"status-select"},[...e[13]||(e[13]=[s("option",{value:"è™•ç†ä¸­"},"è™•ç†ä¸­",-1),s("option",{value:"å·²ç™¼è²¨"},"å·²ç™¼è²¨",-1),s("option",{value:"å·²å®Œæˆ"},"å·²å®Œæˆ",-1),s("option",{value:"å·²å–æ¶ˆ"},"å·²å–æ¶ˆ",-1)])],40,ts))])])]))),128))]))]))}},is=w(as,[["__scopeId","data-v-2794bca4"]]);export{is as default};

import{u as k}from"./cart-BADT1v4O.js";import{a as b}from"./api-lWrPAgcP.js";import{_ as C,c as r,a as s,t as i,h as m,i as I,j as w,F as N,r as x,k as S,l as q,b as F,m as h,p as v,u as V,d as n,q as E}from"./index-DbxxHLbM.js";const $={class:"cart-container"},B={class:"cart-header"},O={class:"count"},U={key:0,class:"empty-cart glass-card"},L={key:1,class:"cart-list"},P={class:"img-box"},R=["src"],W={class:"info"},j={class:"spec"},D={class:"price-row"},K={class:"price"},M={class:"qty-tag"},T=["onClick"],z={class:"checkout-footer glass-card"},A={class:"total-info"},G={class:"amount"},H=["disabled"],J={key:0},Q={key:1,class:"loading-dots"},X={__name:"CartView",setup(Y){const p=V(),c=k(),u=S(()=>c.items),d=F(!1);function f(e){c.removeFromCart(e)}async function y(){if(!(c.totalItems===0||d.value)){d.value=!0;try{const e=h.getUser(),t=e?.userId||"UNKNOWN_USER",_=e?.displayName||"æœªçŸ¥ä½¿ç”¨è€…",a={userId:t,userName:_,items:u.value.map(o=>({pid:o.pid,spec:o.spec,qty:o.qty}))},l=await b.submitOrder(a);if(l.data.status==="success"){const o=l.data.orderId;if(c.clearCart(),h.isInClient())try{await v.sendMessages([{type:"text",text:`æˆ‘å·²ä¸‹å–® #${o}`}]),v.closeWindow()}catch(g){console.error("LIFF Send Error:",g),p.push({name:"history"})}else alert("è¨‚å–®å·²é€å‡ºï¼å–®è™Ÿ: "+o),p.push({name:"history"})}else throw new Error(l.data.message||"ä¸‹å–®å¤±æ•—")}catch(e){alert("çµå¸³å¤±æ•—: "+e.message)}finally{d.value=!1}}}return(e,t)=>{const _=q("router-link");return n(),r("div",$,[s("header",B,[t[0]||(t[0]=s("h1",null,"è³¼ç‰©è»Š",-1)),s("span",O,i(m(c).totalItems)+" ä»¶å•†å“",1)]),u.value.length===0?(n(),r("div",U,[t[2]||(t[2]=s("div",{class:"icon"},"ğŸ›’",-1)),t[3]||(t[3]=s("p",null,"è³¼ç‰©è»Šç›®å‰ç©ºç©ºå¦‚ä¹Ÿ",-1)),I(_,{to:"/",class:"go-shop-btn"},{default:w(()=>[...t[1]||(t[1]=[E("å»é€›é€›",-1)])]),_:1})])):(n(),r("div",L,[(n(!0),r(N,null,x(u.value,(a,l)=>(n(),r("div",{key:l,class:"cart-item glass-card"},[s("div",P,[s("img",{src:a.image_url},null,8,R)]),s("div",W,[s("h3",null,i(a.name),1),s("p",j,i(a.spec),1),s("div",D,[s("span",K,"$ "+i(a.price),1),s("div",M,"x "+i(a.qty),1)]),s("button",{onClick:o=>f(l),class:"del-btn"},"ç§»é™¤",8,T)])]))),128)),s("div",z,[s("div",A,[t[4]||(t[4]=s("span",{class:"label"},"æ‡‰ä»˜ç¸½é¡",-1)),s("span",G,"$ "+i(m(c).totalPrice),1)]),s("button",{onClick:y,class:"checkout-btn",disabled:d.value},[d.value?(n(),r("span",Q,"è™•ç†ä¸­")):(n(),r("span",J,"ç¢ºèªä¸‹å–®"))],8,H)])]))])}}},es=C(X,[["__scopeId","data-v-88763d8e"]]);export{es as default};

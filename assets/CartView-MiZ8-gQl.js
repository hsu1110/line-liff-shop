import{_ as C,f as I,c as i,a as e,t as m,u as _,k as w,l as f,F as N,r as x,h as S,m as q,i as F,p as h,q as V,x as y,s as v,b as B,d as r,y as E,e as P}from"./index-D9BKMBNa.js";import{P as O}from"./ProductRow-Bq9a4zkS.js";import"./image-CPrgbr6F.js";const R={class:"cart-container"},U={class:"cart-header"},$={class:"count"},L={key:0,class:"empty-cart glass-card"},T={key:1,class:"cart-list"},W=["onClick"],z={class:"checkout-footer glass-card"},D={class:"total-info"},K={class:"amount"},M=["disabled"],j={key:0},A={key:1,class:"loading-dots"},G={__name:"CartView",setup(H){const p=B(),n=I(),d=S(()=>n.items),l=F(!1);function k(t){n.removeFromCart(t)}async function g(){if(!(n.totalItems===0||l.value)){l.value=!0;try{const t=h.getUser(),s=t?.userId||"UNKNOWN_USER",u=t?.displayName||"æœªçŸ¥ä½¿ç”¨è€…",a={userId:s,userName:u,items:d.value.map(o=>({pid:o.pid,spec:o.spec,qty:o.qty}))},c=await V.submitOrder(a);if(c.data.status==="success"){const o=c.data.orderId;if(n.clearCart(),h.isInClient())try{await y.sendMessages([{type:"text",text:`æˆ‘å·²ä¸‹å–® #${o}`}]),y.closeWindow()}catch(b){console.error("LIFF Send Error:",b),p.push({name:"history"})}else v("è¨‚å–®å·²é€å‡ºï¼å–®è™Ÿ: "+o,"success"),p.push({name:"history"})}else throw new Error(c.data.message||"ä¸‹å–®å¤±æ•—")}catch(t){v("çµå¸³å¤±æ•—: "+t.message,"error")}finally{l.value=!1}}}return(t,s)=>{const u=q("router-link");return r(),i("div",R,[e("header",U,[s[0]||(s[0]=e("h1",null,"è³¼ç‰©è»Š",-1)),e("span",$,m(_(n).totalItems)+" ä»¶å•†å“",1)]),d.value.length===0?(r(),i("div",L,[s[2]||(s[2]=e("div",{class:"icon"},"ğŸ›’",-1)),s[3]||(s[3]=e("p",null,"è³¼ç‰©è»Šç›®å‰ç©ºç©ºå¦‚ä¹Ÿ",-1)),w(u,{to:"/",class:"go-shop-btn"},{default:f(()=>[...s[1]||(s[1]=[E("å»é€›é€›",-1)])]),_:1})])):(r(),i("div",T,[(r(!0),i(N,null,x(d.value,(a,c)=>(r(),P(O,{key:c,image:a.image_url,title:a.name,spec:a.spec,price:a.price,qty:a.qty,"image-size":200},{actions:f(()=>[e("button",{onClick:o=>k(c),class:"del-btn"},"ç§»é™¤",8,W)]),_:2},1032,["image","title","spec","price","qty"]))),128)),e("div",z,[e("div",D,[s[4]||(s[4]=e("span",{class:"label"},"æ‡‰ä»˜ç¸½é¡",-1)),e("span",K,"$ "+m(_(n).totalPrice),1)]),e("button",{onClick:g,class:"checkout-btn",disabled:l.value},[l.value?(r(),i("span",A,"è™•ç†ä¸­")):(r(),i("span",j,"ç¢ºèªä¸‹å–®"))],8,M)])]))])}}},Y=C(G,[["__scopeId","data-v-421b2539"]]);export{Y as default};

import{_ as L,A as M,d as r,c,a as s,t as g,n as I,u,g as w,w as y,v as k,B as E,C,h as U,D as S,o as V,y as x,F as O,r as T,k as D,i as A,e as F,l as z,z as N,p as B,q as $,s as _}from"./index-C2ow85uB.js";import{u as R}from"./productStore-CaKZATd2.js";import{P as j}from"./ProductCard-n7HXA1-O.js";import{o as q}from"./image-CPrgbr6F.js";const H={class:"modal-content glass-card"},W={class:"form-group image-upload"},G={key:0,class:"placeholder"},J={class:"form-group"},K={class:"form-group"},Q={class:"form-group"},X={class:"form-group"},Y={class:"modal-actions"},Z=["disabled"],ss=["disabled"],ts={__name:"ProductFormModal",props:{show:Boolean,product:Object,submitting:Boolean},emits:["close","save"],setup(f,{emit:d}){const m=f,v=d,b=U(()=>!!m.product),t=S({pid:"",name:"",price:"",description:"",status:"AVAILABLE",image_url:"",imageBase64:""});M(()=>m.product,l=>{l?(t.pid=l.pid,t.name=l.name,t.price=l.price,t.description=l.description||"",t.status=l.status,t.image_url=l.image_url,t.imageBase64=""):(t.pid="",t.name="",t.price="",t.description="",t.status="AVAILABLE",t.image_url="",t.imageBase64="")},{immediate:!0});const h=l=>{const a=l.target.files[0];if(!a)return;if(a.size>1024*1024*5){alert("åœ–ç‰‡å¤§å°ä¸èƒ½è¶…éŽ 5MB");return}const n=new FileReader;n.onload=i=>{t.imageBase64=i.target.result,t.image_url=i.target.result},n.readAsDataURL(a)},P=()=>{if(!t.name||!t.price){alert("è«‹å¡«å¯«å®Œæ•´è³‡è¨Š");return}const l={...t};l.image_url&&l.image_url.startsWith("data:")&&(l.image_url=""),v("save",l)};return(l,a)=>f.show?(r(),c("div",{key:0,class:"modal-overlay",onClick:a[5]||(a[5]=C(n=>v("close"),["self"]))},[s("div",H,[s("h2",null,g(b.value?"ç·¨è¼¯å•†å“":"æ–°å¢žå•†å“"),1),s("div",W,[s("label",{for:"p-image-modal",class:"image-preview",style:I({backgroundImage:`url(${u(q)(t.image_url,600)})`})},[t.image_url?w("",!0):(r(),c("div",G,[...a[6]||(a[6]=[s("span",null,"+",-1),s("p",null,"é»žæ“Šä¸Šå‚³ç…§ç‰‡",-1)])]))],4),s("input",{type:"file",id:"p-image-modal",accept:"image/*",onChange:h,hidden:""},null,32)]),s("div",J,[a[7]||(a[7]=s("label",null,"å•†å“åç¨±",-1)),y(s("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>t.name=n),type:"text",placeholder:"ä¾‹å¦‚: æ—¥æœ¬é™å®šé›¶é£Ÿ"},null,512),[[k,t.name]])]),s("div",K,[a[8]||(a[8]=s("label",null,"åƒ¹æ ¼ ($)",-1)),y(s("input",{"onUpdate:modelValue":a[1]||(a[1]=n=>t.price=n),type:"number",placeholder:"0"},null,512),[[k,t.price]])]),s("div",Q,[a[9]||(a[9]=s("label",null,"å•†å“æè¿°",-1)),y(s("textarea",{"onUpdate:modelValue":a[2]||(a[2]=n=>t.description=n),rows:"3",placeholder:"è¼¸å…¥å•†å“ä»‹ç´¹..."},null,512),[[k,t.description]])]),s("div",X,[a[11]||(a[11]=s("label",null,"ç‹€æ…‹",-1)),y(s("select",{"onUpdate:modelValue":a[3]||(a[3]=n=>t.status=n)},[...a[10]||(a[10]=[s("option",{value:"AVAILABLE"},"ç¾è²¨ (Available)",-1),s("option",{value:"SOLD_OUT"},"å·²å”®å®Œ (Sold Out)",-1),s("option",{value:"TEMP"},"æš«å­˜ (Draft/Hidden)",-1)])],512),[[E,t.status]])]),s("div",Y,[s("button",{onClick:a[4]||(a[4]=n=>v("close")),class:"cancel-btn",disabled:f.submitting},"å–æ¶ˆ",8,Z),s("button",{onClick:P,class:"save-btn",disabled:f.submitting},g(f.submitting?"å„²å­˜ä¸­...":"å„²å­˜"),9,ss)])])])):w("",!0)}},es=L(ts,[["__scopeId","data-v-f517927d"]]),as={class:"admin-container"},os={class:"admin-header glass-card"},ls={class:"header-main"},is={class:"header-btns"},ns={class:"stats-bar"},ds={class:"stat-item"},rs={class:"stat-value"},us={class:"stat-item"},cs={class:"stat-value available"},ms={class:"stat-item"},ps={class:"stat-value sold-out"},vs={class:"stat-item"},gs={class:"stat-value draft"},fs={key:0,class:"loading-state"},bs={key:1,class:"empty-state"},_s={key:2,class:"product-grid"},Ps={class:"admin-actions-col"},ys={class:"admin-btn-group"},hs=["onClick"],ks=["onClick","disabled"],As={key:0},$s={key:1},Cs={__name:"AdminProductView",setup(f){const d=R(),m=A(!1),v=A(!1),b=A(null),t=S(new Set),h=async()=>{await d.fetchProducts()},P=()=>{b.value=null,m.value=!0},l=i=>{b.value=i,m.value=!0},a=async i=>{v.value=!0;const e=B.getUser(),o=!!i.pid&&i.pid!=="";try{let p;o?p=await $.adminUpdateProduct(e.userId,i):p=await $.adminAddProduct(e.userId,i),p.data.status==="success"?(_(o?"æ›´æ–°æˆåŠŸ":"æ–°å¢žæˆåŠŸ","success"),m.value=!1,await d.fetchProducts(!0)):_(p.data.message||"å„²å­˜å¤±æ•—","error")}catch(p){console.error(p),_("é€£ç·šéŒ¯èª¤","error")}finally{v.value=!1}},n=async i=>{if(!confirm("ç¢ºå®šè¦åˆªé™¤æ­¤å•†å“å—Žï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŽŸã€‚"))return;const e=B.getUser();t.add(i);try{await $.adminDeleteProduct(e.userId,i),d.removeProductFromStore(i),_("å•†å“å·²åˆªé™¤","success")}catch{_("åˆªé™¤å¤±æ•—","error")}finally{t.delete(i)}};return V(h),(i,e)=>(r(),c("div",as,[s("header",os,[s("div",ls,[e[3]||(e[3]=s("div",{class:"header-info"},[s("h1",null,"å•†å“ç®¡ç†ä¸­å¿ƒ"),s("p",{class:"admin-subtitle"},"ç®¡ç†å•†åŸŽåº«å­˜èˆ‡å•†å“å…§å®¹")],-1)),s("div",is,[s("button",{onClick:e[0]||(e[0]=o=>i.$router.push("/admin/orders")),class:"sub-nav-btn"}," è¨‚å–®ç®¡ç†ä¸­å¿ƒ â†’ "),s("button",{onClick:P,class:"add-btn primary-btn"},[...e[2]||(e[2]=[s("span",null,"+",-1),x(" æ–°å¢žå•†å“ ",-1)])])])]),s("div",ns,[s("div",ds,[e[4]||(e[4]=s("span",{class:"stat-label"},"ç¸½å•†å“æ•¸",-1)),s("span",rs,g(u(d).allProducts.length),1)]),e[8]||(e[8]=s("div",{class:"stat-divider"},null,-1)),s("div",us,[e[5]||(e[5]=s("span",{class:"stat-label"},"ç¾è²¨",-1)),s("span",cs,g(u(d).allProducts.filter(o=>o.status==="AVAILABLE").length),1)]),e[9]||(e[9]=s("div",{class:"stat-divider"},null,-1)),s("div",ms,[e[6]||(e[6]=s("span",{class:"stat-label"},"å·²å”®å®Œ",-1)),s("span",ps,g(u(d).allProducts.filter(o=>o.status==="SOLD_OUT").length),1)]),e[10]||(e[10]=s("div",{class:"stat-divider"},null,-1)),s("div",vs,[e[7]||(e[7]=s("span",{class:"stat-label"},"æš«å­˜",-1)),s("span",gs,g(u(d).allProducts.filter(o=>o.status==="TEMP").length),1)])])]),u(d).loading&&u(d).allProducts.length===0?(r(),c("div",fs,[...e[11]||(e[11]=[s("div",{class:"spinner"},null,-1),s("p",null,"æ­£åœ¨å¾žæ—¥æœ¬ä¼ºæœå™¨åŒæ­¥è³‡æ–™...",-1)])])):u(d).allProducts.length===0?(r(),c("div",bs,[e[12]||(e[12]=s("div",{class:"empty-icon"},"ðŸ“¦",-1)),e[13]||(e[13]=s("p",null,"ç›®å‰åº«å­˜ç©ºç©ºå¦‚ä¹Ÿ",-1)),s("button",{onClick:P,class:"add-btn-outline"},"ç«‹å³ä¸Šæž¶é¦–ä»¶å•†å“")])):(r(),c("div",_s,[(r(!0),c(O,null,T(u(d).allProducts,o=>(r(),F(j,{key:o.pid,product:o,"show-status":!1},{footer:z(()=>[s("div",Ps,[s("span",{class:N(["status-badge",o.status])},g(o.status==="AVAILABLE"?"ç¾è²¨":o.status==="SOLD_OUT"?"å·²å”®å®Œ":"æš«å­˜"),3),s("div",ys,[s("button",{onClick:C(p=>l(o),["stop"]),class:"action-btn edit"},"ç·¨è¼¯",8,hs),s("button",{onClick:C(p=>n(o.pid),["stop"]),class:"action-btn delete-icon",disabled:t.has(o.pid)},[t.has(o.pid)?(r(),c("span",As,"â³")):(r(),c("span",$s,"ðŸ—‘ï¸"))],8,ks)])])]),_:2},1032,["product"]))),128))])),D(es,{show:m.value,product:b.value,submitting:v.value,onClose:e[1]||(e[1]=o=>m.value=!1),onSave:a},null,8,["show","product","submitting"])]))}},Ms=L(Cs,[["__scopeId","data-v-410a399d"]]);export{Ms as default};

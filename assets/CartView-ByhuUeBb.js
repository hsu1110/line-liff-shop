import{u as v}from"./cart-BbRZVYfy.js";import{a as y}from"./api-lWrPAgcP.js";import{_ as k,c,a as t,F as I,r as C,t as n,h as g,i as N,l as S,j as d,u as b,e as i}from"./index-CZNjXMCB.js";const w={class:"cart-container"},x={key:0,class:"empty-cart"},F={key:1},q={class:"img"},$=["src"],B={class:"info"},E={class:"price-qty"},O=["onClick"],R={class:"footer"},U={class:"total"},V={__name:"CartView",setup(L){const _=b(),a=v(),u=N(()=>a.items);function f(s){a.removeFromCart(s)}async function h(){if(a.totalItems!==0)try{const s=S.getUser(),l=s?.userId||"UNKNOWN_USER",e=s?.displayName||"未知使用者";let r=null;for(const o of u.value){const m=await y.submitOrder({pid:o.pid,userId:l,userName:e,spec:o.spec,qty:o.qty});m.data.status==="success"&&(r=m.data)}a.clearCart(),alert("訂單已送出！");const p=r.orderId;if(d.isInClient())try{await d.sendMessages([{type:"text",text:`我已下單 #${p}`}]),d.closeWindow()}catch(o){console.error("LIFF Send Error:",o),_.push({name:"history"})}else _.push({name:"history"})}catch(s){alert("結帳失敗: "+s)}}return(s,l)=>(i(),c("div",w,[l[0]||(l[0]=t("h1",null,"購物車",-1)),u.value.length===0?(i(),c("div",x," 購物車是空的 ")):(i(),c("div",F,[(i(!0),c(I,null,C(u.value,(e,r)=>(i(),c("div",{key:r,class:"cart-item"},[t("div",q,[t("img",{src:e.image_url},null,8,$)]),t("div",B,[t("h3",null,n(e.name),1),t("p",null,n(e.spec),1),t("div",E,[t("span",null,"$ "+n(e.price),1),t("span",null,"x "+n(e.qty),1)]),t("button",{onClick:p=>f(r),class:"del-btn"},"移除",8,O)])]))),128)),t("div",R,[t("div",U,"總計: $ "+n(g(a).totalPrice),1),t("button",{onClick:h,class:"checkout-btn"},"送出訂單")])]))]))}},K=k(V,[["__scopeId","data-v-f6acd279"]]);export{K as default};

import{u as g}from"./cart-BBzGA6L_.js";import{a as k}from"./api-lWrPAgcP.js";import{_ as C,c as n,a as s,F as b,r as N,t as r,h as p,i as S,l as f,j as h,u as w,e as i}from"./index-Cf6z_Dgo.js";const x={class:"cart-container"},F={key:0,class:"empty-cart"},q={key:1},$={class:"img"},B=["src"],E={class:"info"},U={class:"price-qty"},V=["onClick"],L={class:"footer"},O={class:"total"},P=["disabled"],R={__name:"CartView",setup(W){const m=w(),o=g(),_=S(()=>o.items);function v(e){o.removeFromCart(e)}const c=ref(!1);async function y(){if(!(o.totalItems===0||c.value)){c.value=!0;try{const e=f.getUser(),l=e?.userId||"UNKNOWN_USER",t=e?.displayName||"未知使用者",d=_.value.map(a=>({pid:a.pid,spec:a.spec,qty:a.qty})),u=await k.submitOrder({items:d,userId:l,userName:t});if(u.data.status==="success"){const a=u.data.orderId;if(o.clearCart(),f.isInClient())try{await h.sendMessages([{type:"text",text:`我已下單 #${a}`}]),h.closeWindow()}catch(I){console.error("LIFF Send Error:",I),m.push({name:"history"})}else alert("訂單已送出！單號: #"+a),m.push({name:"history"})}else alert("結帳失敗: "+(u.data.message||"未知錯誤"))}catch(e){alert("系統連線錯誤: "+e)}finally{c.value=!1}}}return(e,l)=>(i(),n("div",x,[l[0]||(l[0]=s("h1",null,"購物車",-1)),_.value.length===0?(i(),n("div",F," 購物車是空的 ")):(i(),n("div",q,[(i(!0),n(b,null,N(_.value,(t,d)=>(i(),n("div",{key:d,class:"cart-item"},[s("div",$,[s("img",{src:t.image_url},null,8,B)]),s("div",E,[s("h3",null,r(t.name),1),s("p",null,r(t.spec),1),s("div",U,[s("span",null,"$ "+r(t.price),1),s("span",null,"x "+r(t.qty),1)]),s("button",{onClick:u=>v(d),class:"del-btn"},"移除",8,V)])]))),128)),s("div",L,[s("div",O,"總計: $ "+r(p(o).totalPrice),1),s("button",{onClick:y,class:"checkout-btn",disabled:p(c)},r(p(c)?"處理中...":"送出訂單"),9,P)])]))]))}},M=C(R,[["__scopeId","data-v-bd69ae9e"]]);export{M as default};

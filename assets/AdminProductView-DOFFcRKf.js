import{_ as P,B as I,f as u,c as p,b as t,t as B,n as U,i as L,w as k,v as C,C as E,D as $,p as M,E as S,o as V,z as x,F,r as O,l as D,a as b,k as _,g as T,m as z,A as N,x as w,s as m}from"./index-IQMME31T.js";import{P as R}from"./ProductCard-C0f5hhen.js";import"./image-CPrgbr6F.js";const j={class:"modal-content glass-card"},W={class:"form-group image-upload"},q={key:0,class:"placeholder"},G={class:"form-group"},H={class:"form-group"},J={class:"form-group"},K={class:"form-group"},Q={class:"modal-actions"},X=["disabled"],Y=["disabled"],Z={__name:"ProductFormModal",props:{show:Boolean,product:Object,submitting:Boolean},emits:["close","save"],setup(v,{emit:c}){const g=v,d=c,f=M(()=>!!g.product),e=S({pid:"",name:"",price:"",description:"",status:"AVAILABLE",image_url:"",imageBase64:""});I(()=>g.product,o=>{o?(e.pid=o.pid,e.name=o.name,e.price=o.price,e.description=o.description||"",e.status=o.status,e.image_url=o.image_url,e.imageBase64=""):(e.pid="",e.name="",e.price="",e.description="",e.status="AVAILABLE",e.image_url="",e.imageBase64="")},{immediate:!0});const A=o=>{const s=o.target.files[0];if(!s)return;if(s.size>1024*1024*5){alert("圖片大小不能超過 5MB");return}const n=new FileReader;n.onload=y=>{e.imageBase64=y.target.result,e.image_url=y.target.result},n.readAsDataURL(s)},h=()=>{if(!e.name||!e.price){alert("請填寫完整資訊");return}const o={...e};o.image_url&&o.image_url.startsWith("data:")&&(o.image_url=""),d("save",o)};return(o,s)=>v.show?(u(),p("div",{key:0,class:"modal-overlay",onClick:s[5]||(s[5]=$(n=>d("close"),["self"]))},[t("div",j,[t("h2",null,B(f.value?"編輯商品":"新增商品"),1),t("div",W,[t("label",{for:"p-image-modal",class:"image-preview",style:U({backgroundImage:`url(${e.image_url})`})},[e.image_url?L("",!0):(u(),p("div",q,[...s[6]||(s[6]=[t("span",null,"+",-1),t("p",null,"點擊上傳照片",-1)])]))],4),t("input",{type:"file",id:"p-image-modal",accept:"image/*",onChange:A,hidden:""},null,32)]),t("div",G,[s[7]||(s[7]=t("label",null,"商品名稱",-1)),k(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>e.name=n),type:"text",placeholder:"例如: 日本限定零食"},null,512),[[C,e.name]])]),t("div",H,[s[8]||(s[8]=t("label",null,"價格 ($)",-1)),k(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.price=n),type:"number",placeholder:"0"},null,512),[[C,e.price]])]),t("div",J,[s[9]||(s[9]=t("label",null,"商品描述",-1)),k(t("textarea",{"onUpdate:modelValue":s[2]||(s[2]=n=>e.description=n),rows:"3",placeholder:"輸入商品介紹..."},null,512),[[C,e.description]])]),t("div",K,[s[11]||(s[11]=t("label",null,"狀態",-1)),k(t("select",{"onUpdate:modelValue":s[3]||(s[3]=n=>e.status=n)},[...s[10]||(s[10]=[t("option",{value:"AVAILABLE"},"上架中 (Available)",-1),t("option",{value:"SOLD_OUT"},"已售完 (Sold Out)",-1)])],512),[[E,e.status]])]),t("div",Q,[t("button",{onClick:s[4]||(s[4]=n=>d("close")),class:"cancel-btn",disabled:v.submitting},"取消",8,X),t("button",{onClick:h,class:"save-btn",disabled:v.submitting},B(v.submitting?"儲存中...":"儲存"),9,Y)])])])):L("",!0)}},tt=P(Z,[["__scopeId","data-v-4771d45a"]]),et={class:"admin-container"},st={class:"admin-header"},at={class:"header-actions"},ot={key:0,class:"loading-state"},lt={key:1,class:"empty-state"},it={key:2,class:"product-grid"},nt={class:"admin-actions"},rt=["onClick"],dt=["onClick"],ut=["onClick"],ct={__name:"AdminProductView",setup(v){const c=_([]),g=_(!0),d=_(!1),f=_(!1),e=_(null),A=async()=>{g.value=!0;try{const l=await b.getProducts();c.value=l.data.data}finally{g.value=!1}},h=()=>{e.value=null,d.value=!0},o=l=>{e.value=l,d.value=!0},s=async l=>{f.value=!0;const a=w.getUser(),i=!!l.pid&&l.pid!=="";try{let r;i?r=await b.adminUpdateProduct(a.userId,l):r=await b.adminAddProduct(a.userId,l),r.data.status==="success"?(m(i?"更新成功":"新增成功","success"),d.value=!1,await A()):m(r.data.message||"儲存失敗","error")}catch(r){console.error(r),m("連線錯誤","error")}finally{f.value=!1}},n=async l=>{const a=l.status==="AVAILABLE"?"SOLD_OUT":"AVAILABLE",i=w.getUser();try{await b.adminUpdateProduct(i.userId,{...l,status:a}),l.status=a,m(`狀態已更新為 ${a}`,"success")}catch{m("更新失敗","error")}},y=async l=>{if(!confirm("確定要刪除此商品嗎？此操作無法復原。"))return;const a=w.getUser();try{await b.adminDeleteProduct(a.userId,l),c.value=c.value.filter(i=>i.pid!==l),m("商品已刪除","success")}catch{m("刪除失敗","error")}};return V(A),(l,a)=>(u(),p("div",et,[t("header",st,[t("div",{class:"header-top"},[a[3]||(a[3]=t("h1",null,"商品管理中心",-1)),t("button",{onClick:h,class:"add-btn"},[...a[2]||(a[2]=[t("span",null,"+",-1),x(" 新增商品 ",-1)])])]),t("div",at,[t("button",{onClick:a[0]||(a[0]=i=>l.$router.push("/admin/orders")),class:"sub-nav-btn"},"訂單管理 →")])]),g.value?(u(),p("div",ot,[...a[4]||(a[4]=[t("div",{class:"spinner"},null,-1),t("p",null,"載入中...",-1)])])):c.value.length===0?(u(),p("div",lt,[...a[5]||(a[5]=[t("p",null,"目前沒有商品，點擊右上角「新增」開始上架。",-1)])])):(u(),p("div",it,[(u(!0),p(F,null,O(c.value,i=>(u(),T(R,{key:i.pid,product:i,"show-status":!1},{footer:z(()=>[t("div",nt,[t("button",{onClick:$(r=>o(i),["stop"]),class:"action-btn edit"},"編輯",8,rt),t("button",{onClick:$(r=>n(i),["stop"]),class:N(["action-btn status",i.status])},B(i.status==="AVAILABLE"?"下架":"上架"),11,dt),t("button",{onClick:$(r=>y(i.pid),["stop"]),class:"action-btn delete"},"刪除",8,ut)])]),_:2},1032,["product"]))),128))])),D(tt,{show:d.value,product:e.value,submitting:f.value,onClose:a[1]||(a[1]=i=>d.value=!1),onSave:s},null,8,["show","product","submitting"])]))}},gt=P(ct,[["__scopeId","data-v-f7666fb5"]]);export{gt as default};

import{u as b}from"./cart-DHeeR0ZS.js";import{a as I}from"./api-lWrPAgcP.js";import{_ as C,c as r,a as s,t as l,e as p,i as w,j as N,F as x,r as S,k as q,l as F,b as V,m as h,p as f,s as v,u as E,d as n,q as $}from"./index-DZG6CjIN.js";import{o as B}from"./image-CPrgbr6F.js";const O={class:"cart-container"},U={class:"cart-header"},L={class:"count"},P={key:0,class:"empty-cart glass-card"},R={key:1,class:"cart-list"},T={class:"img-box"},W=["src"],j={class:"info"},z={class:"spec"},D={class:"price-row"},K={class:"price"},M={class:"qty-tag"},A=["onClick"],G={class:"checkout-footer glass-card"},H={class:"total-info"},J={class:"amount"},Q=["disabled"],X={key:0},Y={key:1,class:"loading-dots"},Z={__name:"CartView",setup(ss){const m=E(),c=b(),u=q(()=>c.items),d=V(!1);function y(e){c.removeFromCart(e)}async function g(){if(!(c.totalItems===0||d.value)){d.value=!0;try{const e=h.getUser(),t=e?.userId||"UNKNOWN_USER",_=e?.displayName||"æœªçŸ¥ä½¿ç”¨è€…",o={userId:t,userName:_,items:u.value.map(a=>({pid:a.pid,spec:a.spec,qty:a.qty}))},i=await I.submitOrder(o);if(i.data.status==="success"){const a=i.data.orderId;if(c.clearCart(),h.isInClient())try{await f.sendMessages([{type:"text",text:`æˆ‘å·²ä¸‹å–® #${a}`}]),f.closeWindow()}catch(k){console.error("LIFF Send Error:",k),m.push({name:"history"})}else v("è¨‚å–®å·²é€å‡ºï¼å–®è™Ÿ: "+a,"success"),m.push({name:"history"})}else throw new Error(i.data.message||"ä¸‹å–®å¤±æ•—")}catch(e){v("çµå¸³å¤±æ•—: "+e.message,"error")}finally{d.value=!1}}}return(e,t)=>{const _=F("router-link");return n(),r("div",O,[s("header",U,[t[0]||(t[0]=s("h1",null,"è³¼ç‰©è»Š",-1)),s("span",L,l(p(c).totalItems)+" ä»¶å•†å“",1)]),u.value.length===0?(n(),r("div",P,[t[2]||(t[2]=s("div",{class:"icon"},"ğŸ›’",-1)),t[3]||(t[3]=s("p",null,"è³¼ç‰©è»Šç›®å‰ç©ºç©ºå¦‚ä¹Ÿ",-1)),w(_,{to:"/",class:"go-shop-btn"},{default:N(()=>[...t[1]||(t[1]=[$("å»é€›é€›",-1)])]),_:1})])):(n(),r("div",R,[(n(!0),r(x,null,S(u.value,(o,i)=>(n(),r("div",{key:i,class:"cart-item glass-card"},[s("div",T,[s("img",{src:p(B)(o.image_url,200)},null,8,W)]),s("div",j,[s("h3",null,l(o.name),1),s("p",z,l(o.spec),1),s("div",D,[s("span",K,"$ "+l(o.price),1),s("div",M,"x "+l(o.qty),1)]),s("button",{onClick:a=>y(i),class:"del-btn"},"ç§»é™¤",8,A)])]))),128)),s("div",G,[s("div",H,[t[4]||(t[4]=s("span",{class:"label"},"æ‡‰ä»˜ç¸½é¡",-1)),s("span",J,"$ "+l(p(c).totalPrice),1)]),s("button",{onClick:g,class:"checkout-btn",disabled:d.value},[d.value?(n(),r("span",Y,"è™•ç†ä¸­")):(n(),r("span",X,"ç¢ºèªä¸‹å–®"))],8,Q)])]))])}}},rs=C(Z,[["__scopeId","data-v-da547655"]]);export{rs as default};

import{_ as w,o as q,p,q as x,c as i,a as s,t as l,F as f,r as h,i as u,h as g,d as o,z as y,k as C,l as I}from"./index-C2ow85uB.js";import{P as S}from"./ProductRow-Cnr1Vkjq.js";import"./image-CPrgbr6F.js";const z={class:"history-container"},B={class:"admin-header glass-card"},E={class:"stats-bar"},F={class:"stat-item"},M={class:"stat-value"},V={class:"stat-item"},N={class:"stat-value processing"},O={class:"stat-item"},$={class:"stat-value shipped"},H={class:"stat-item"},L={class:"stat-value completed"},P={class:"stat-item"},R={class:"stat-value cancelled"},T={class:"filter-bar"},A=["onClick"],D={key:0,class:"loading-state"},U={key:1,class:"error"},j={key:2,class:"empty"},G={key:3,class:"order-list"},J={class:"card-header"},K={class:"order-id"},Q={class:"time"},W={class:"total-row"},X={class:"card-footer"},Y={__name:"HistoryView",setup(Z){const c=u([]),v=u(!0),d=u(""),n=u("全部"),k=["全部","處理中","已發貨","已完成","已取消"],_=g(()=>n.value==="全部"?c.value:c.value.filter(a=>a.order_status===n.value));q(async()=>{try{p.profile||await p.init();const a=p.getUser();if(!a||!a.userId){d.value="無法取得使用者資訊，請重新登入",v.value=!1;return}const t=await x.getOrders(a.userId);t.data.status==="success"?c.value=t.data.data:d.value=t.data.message}catch(a){console.error(a),d.value="讀取失敗，請稍後再試"}finally{v.value=!1}});const r=g(()=>{const a={total:0,processing:0,shipped:0,completed:0,cancelled:0},t=new Map;return c.value.forEach(e=>{t.has(e.order_id)||t.set(e.order_id,e.order_status)}),a.total=t.size,t.forEach(e=>{!e||e==="處理中"?a.processing++:e==="已發貨"?a.shipped++:e==="已完成"?a.completed++:e==="已取消"&&a.cancelled++}),a}),b=a=>{switch(a){case"已完成":return"done";case"已發貨":return"shipped";case"已取消":return"cancelled";default:return"pending"}};return(a,t)=>(o(),i("div",z,[s("header",B,[t[9]||(t[9]=s("div",{class:"header-main"},[s("div",{class:"header-info"},[s("h1",null,"我的訂單"),s("p",{class:"admin-subtitle"},"查看訂單紀錄與配送狀態")])],-1)),s("div",E,[s("div",F,[t[0]||(t[0]=s("span",{class:"stat-label"},"總訂單",-1)),s("span",M,l(r.value.total),1)]),t[5]||(t[5]=s("div",{class:"stat-divider"},null,-1)),s("div",V,[t[1]||(t[1]=s("span",{class:"stat-label"},"處理中",-1)),s("span",N,l(r.value.processing),1)]),t[6]||(t[6]=s("div",{class:"stat-divider"},null,-1)),s("div",O,[t[2]||(t[2]=s("span",{class:"stat-label"},"已發貨",-1)),s("span",$,l(r.value.shipped),1)]),t[7]||(t[7]=s("div",{class:"stat-divider"},null,-1)),s("div",H,[t[3]||(t[3]=s("span",{class:"stat-label"},"已完成",-1)),s("span",L,l(r.value.completed),1)]),t[8]||(t[8]=s("div",{class:"stat-divider"},null,-1)),s("div",P,[t[4]||(t[4]=s("span",{class:"stat-label"},"已取消",-1)),s("span",R,l(r.value.cancelled),1)])])]),s("div",T,[(o(),i(f,null,h(k,e=>s("button",{key:e,class:y(["filter-tab",{active:n.value===e}]),onClick:m=>n.value=e},l(e),11,A)),64))]),v.value?(o(),i("div",D,[...t[10]||(t[10]=[s("div",{class:"spinner"},null,-1),s("p",null,"載入中...",-1)])])):d.value?(o(),i("div",U,l(d.value),1)):_.value.length===0?(o(),i("div",j,l(n.value==="全部"?"尚無訂單記錄":`沒有「${n.value}」的訂單`),1)):(o(),i("div",G,[(o(!0),i(f,null,h(_.value,(e,m)=>(o(),i("div",{key:m,class:"order-card glass-card"},[s("div",J,[s("span",K,"#"+l(e.order_id),1),s("span",Q,l(e.time),1)]),C(S,{image:e.image_url||"https://via.placeholder.com/200?text=No+Image",title:e.item_name,spec:e.spec,price:Math.round(e.total/e.qty),qty:e.qty,"image-size":200},{footer:I(()=>[s("div",W,"小計: $ "+l(e.total),1)]),_:2},1032,["image","title","spec","price","qty"]),s("div",X,[s("span",{class:y(["status-badge",b(e.order_status)])},l(e.order_status||"處理中"),3)])]))),128))]))]))}},as=w(Y,[["__scopeId","data-v-01c8c73b"]]);export{as as default};

import{_ as C,h as I,c as l,b as e,t as m,u as _,l as w,m as f,F as N,r as x,p as S,q,k as F,x as h,a as V,y,s as v,e as B,f as r,z as E,g as P}from"./index-BWPVaM0V.js";import{P as O}from"./ProductRow-DCMJHUeu.js";import"./image-CPrgbr6F.js";const R={class:"cart-container"},U={class:"cart-header"},$={class:"count"},z={key:0,class:"empty-cart glass-card"},L={key:1,class:"cart-list"},T=["onClick"],W={class:"checkout-footer glass-card"},D={class:"total-info"},K={class:"amount"},M=["disabled"],j={key:0},A={key:1,class:"loading-dots"},G={__name:"CartView",setup(H){const p=B(),n=I(),d=S(()=>n.items),i=F(!1);function g(t){n.removeFromCart(t)}async function k(){if(!(n.totalItems===0||i.value)){i.value=!0;try{const t=h.getUser(),s=t?.userId||"UNKNOWN_USER",u=t?.displayName||"æœªçŸ¥ä½¿ç”¨è€…",a={userId:s,userName:u,items:d.value.map(o=>({pid:o.pid,spec:o.spec,qty:o.qty}))},c=await V.submitOrder(a);if(c.data.status==="success"){const o=c.data.orderId;if(n.clearCart(),h.isInClient())try{await y.sendMessages([{type:"text",text:`æˆ‘å·²ä¸‹å–® #${o}`}]),y.closeWindow()}catch(b){console.error("LIFF Send Error:",b),p.push({name:"history"})}else v("è¨‚å–®å·²é€å‡ºï¼å–®è™Ÿ: "+o,"success"),p.push({name:"history"})}else throw new Error(c.data.message||"ä¸‹å–®å¤±æ•—")}catch(t){v("çµå¸³å¤±æ•—: "+t.message,"error")}finally{i.value=!1}}}return(t,s)=>{const u=q("router-link");return r(),l("div",R,[e("header",U,[s[0]||(s[0]=e("h1",null,"è³¼ç‰©è»Š",-1)),e("span",$,m(_(n).totalItems)+" ä»¶å•†å“",1)]),d.value.length===0?(r(),l("div",z,[s[2]||(s[2]=e("div",{class:"icon"},"ğŸ›’",-1)),s[3]||(s[3]=e("p",null,"è³¼ç‰©è»Šç›®å‰ç©ºç©ºå¦‚ä¹Ÿ",-1)),w(u,{to:"/",class:"go-shop-btn"},{default:f(()=>[...s[1]||(s[1]=[E("å»é€›é€›",-1)])]),_:1})])):(r(),l("div",L,[(r(!0),l(N,null,x(d.value,(a,c)=>(r(),P(O,{key:c,image:a.image_url,title:a.name,spec:a.spec,price:a.price,qty:a.qty,"image-size":200},{actions:f(()=>[e("button",{onClick:o=>g(c),class:"del-btn"},"ç§»é™¤",8,T)]),_:2},1032,["image","title","spec","price","qty"]))),128)),e("div",W,[e("div",D,[s[4]||(s[4]=e("span",{class:"label"},"æ‡‰ä»˜ç¸½é¡",-1)),e("span",K,"$ "+m(_(n).totalPrice),1)]),e("button",{onClick:k,class:"checkout-btn",disabled:i.value},[i.value?(r(),l("span",A,"è™•ç†ä¸­")):(r(),l("span",j,"ç¢ºèªä¸‹å–®"))],8,M)])]))])}}},Y=C(G,[["__scopeId","data-v-421b2539"]]);export{Y as default};

import{_ as P,B as I,f as u,c as p,b as t,t as B,n as U,i as L,w as k,v as h,C as E,D as $,p as M,E as S,o as V,z as x,F,r as O,l as T,a as b,k as _,g as z,m as D,A as N,x as w,s as m}from"./index-BWPVaM0V.js";import{P as R}from"./ProductCard-BuZXdkjV.js";import"./image-CPrgbr6F.js";const j={class:"modal-content glass-card"},q={class:"form-group image-upload"},G={key:0,class:"placeholder"},H={class:"form-group"},J={class:"form-group"},K={class:"form-group"},Q={class:"form-group"},W={class:"modal-actions"},X=["disabled"],Y=["disabled"],Z={__name:"ProductFormModal",props:{show:Boolean,product:Object,submitting:Boolean},emits:["close","save"],setup(v,{emit:c}){const g=v,r=c,f=M(()=>!!g.product),e=S({pid:"",name:"",price:"",description:"",status:"AVAILABLE",image_url:"",imageBase64:""});I(()=>g.product,i=>{i?(e.pid=i.pid,e.name=i.name,e.price=i.price,e.description=i.description||"",e.status=i.status,e.image_url=i.image_url,e.imageBase64=""):(e.pid="",e.name="",e.price="",e.description="",e.status="AVAILABLE",e.image_url="",e.imageBase64="")},{immediate:!0});const A=i=>{const s=i.target.files[0];if(!s)return;if(s.size>1024*1024*5){alert("圖片大小不能超過 5MB");return}const n=new FileReader;n.onload=y=>{e.imageBase64=y.target.result,e.image_url=y.target.result},n.readAsDataURL(s)},C=()=>{if(!e.name||!e.price){alert("請填寫完整資訊");return}r("save",{...e})};return(i,s)=>v.show?(u(),p("div",{key:0,class:"modal-overlay",onClick:s[5]||(s[5]=$(n=>r("close"),["self"]))},[t("div",j,[t("h2",null,B(f.value?"編輯商品":"新增商品"),1),t("div",q,[t("label",{for:"p-image-modal",class:"image-preview",style:U({backgroundImage:`url(${e.image_url})`})},[e.image_url?L("",!0):(u(),p("div",G,[...s[6]||(s[6]=[t("span",null,"+",-1),t("p",null,"點擊上傳照片",-1)])]))],4),t("input",{type:"file",id:"p-image-modal",accept:"image/*",onChange:A,hidden:""},null,32)]),t("div",H,[s[7]||(s[7]=t("label",null,"商品名稱",-1)),k(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>e.name=n),type:"text",placeholder:"例如: 日本限定零食"},null,512),[[h,e.name]])]),t("div",J,[s[8]||(s[8]=t("label",null,"價格 ($)",-1)),k(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.price=n),type:"number",placeholder:"0"},null,512),[[h,e.price]])]),t("div",K,[s[9]||(s[9]=t("label",null,"商品描述",-1)),k(t("textarea",{"onUpdate:modelValue":s[2]||(s[2]=n=>e.description=n),rows:"3",placeholder:"輸入商品介紹..."},null,512),[[h,e.description]])]),t("div",Q,[s[11]||(s[11]=t("label",null,"狀態",-1)),k(t("select",{"onUpdate:modelValue":s[3]||(s[3]=n=>e.status=n)},[...s[10]||(s[10]=[t("option",{value:"AVAILABLE"},"上架中 (Available)",-1),t("option",{value:"SOLD_OUT"},"已售完 (Sold Out)",-1)])],512),[[E,e.status]])]),t("div",W,[t("button",{onClick:s[4]||(s[4]=n=>r("close")),class:"cancel-btn",disabled:v.submitting},"取消",8,X),t("button",{onClick:C,class:"save-btn",disabled:v.submitting},B(v.submitting?"儲存中...":"儲存"),9,Y)])])])):L("",!0)}},tt=P(Z,[["__scopeId","data-v-2afa1f6a"]]),et={class:"admin-container"},st={class:"admin-header"},at={class:"header-actions"},ot={key:0,class:"loading-state"},lt={key:1,class:"empty-state"},nt={key:2,class:"product-grid"},it={class:"admin-actions"},dt=["onClick"],rt=["onClick"],ut=["onClick"],ct={__name:"AdminProductView",setup(v){const c=_([]),g=_(!0),r=_(!1),f=_(!1),e=_(null),A=async()=>{g.value=!0;try{const o=await b.getProducts();c.value=o.data.data}finally{g.value=!1}},C=()=>{e.value=null,r.value=!0},i=o=>{e.value=o,r.value=!0},s=async o=>{f.value=!0;const a=w.getUser(),l=!!o.pid&&o.pid!=="";try{let d;l?d=await b.adminUpdateProduct(a.userId,o):d=await b.adminAddProduct(a.userId,o),d.data.status==="success"?(m(l?"更新成功":"新增成功","success"),r.value=!1,await A()):m(d.data.message||"儲存失敗","error")}catch(d){console.error(d),m("連線錯誤","error")}finally{f.value=!1}},n=async o=>{const a=o.status==="AVAILABLE"?"SOLD_OUT":"AVAILABLE",l=w.getUser();try{await b.adminUpdateProduct(l.userId,{...o,status:a}),o.status=a,m(`狀態已更新為 ${a}`,"success")}catch{m("更新失敗","error")}},y=async o=>{if(!confirm("確定要刪除此商品嗎？此操作無法復原。"))return;const a=w.getUser();try{await b.adminDeleteProduct(a.userId,o),c.value=c.value.filter(l=>l.pid!==o),m("商品已刪除","success")}catch{m("刪除失敗","error")}};return V(A),(o,a)=>(u(),p("div",et,[t("header",st,[t("div",{class:"header-top"},[a[3]||(a[3]=t("h1",null,"商品管理中心",-1)),t("button",{onClick:C,class:"add-btn"},[...a[2]||(a[2]=[t("span",null,"+",-1),x(" 新增商品 ",-1)])])]),t("div",at,[t("button",{onClick:a[0]||(a[0]=l=>o.$router.push("/admin/orders")),class:"sub-nav-btn"},"訂單管理 →")])]),g.value?(u(),p("div",ot,[...a[4]||(a[4]=[t("div",{class:"spinner"},null,-1),t("p",null,"載入中...",-1)])])):c.value.length===0?(u(),p("div",lt,[...a[5]||(a[5]=[t("p",null,"目前沒有商品，點擊右上角「新增」開始上架。",-1)])])):(u(),p("div",nt,[(u(!0),p(F,null,O(c.value,l=>(u(),z(R,{key:l.pid,product:l,"show-status":!1},{footer:D(()=>[t("div",it,[t("button",{onClick:$(d=>i(l),["stop"]),class:"action-btn edit"},"編輯",8,dt),t("button",{onClick:$(d=>n(l),["stop"]),class:N(["action-btn status",l.status])},B(l.status==="AVAILABLE"?"下架":"上架"),11,rt),t("button",{onClick:$(d=>y(l.pid),["stop"]),class:"action-btn delete"},"刪除",8,ut)])]),_:2},1032,["product"]))),128))])),T(tt,{show:r.value,product:e.value,submitting:f.value,onClose:a[1]||(a[1]=l=>r.value=!1),onSave:s},null,8,["show","product","submitting"])]))}},gt=P(ct,[["__scopeId","data-v-f7666fb5"]]);export{gt as default};
